# 검색 시스템의 이해

## 검색엔진 (Search Engine)
- 광활한 웹에서 정보를 수집해 검색 결과를 제공하는 프로그램
- 검색 결과로 제공되는 데이터의 특성에 따라 구현 형태가 각각 달라짐
## 검색 시스템 (Search System)
- 대용량 데이터를 기반으로 신뢰성 있는 검색 결과를 제공하기 위해 검색 엔진을 기반으로 구축된 시스템을 통칭하는 용어
- 수집기를 이용해 방대한 데이터를 수집하고 이를 다수의 검색엔진을 이용해 색인하고 검색 결과를 UI로 제공
## 검색 서비스 (Search Service)
- 검색엔진을 기반으로 구축된 검색 시스템을 활용해 검색 결과를 서비스로 제공
```
검색 서비스 > 검색 시스템 > 검색 엔진
```

# 검색 시스템의 구성 요소
## 수집기
- 웹사이트, 블로그, 카페 등 웹에서 필요한 정보를 수집하는 프로그램
- 크롤러(Crawler), 스파이더(Spider), 웜(Worms), 웹로봇(Web Robot) 등으로 불린다.
- 파일, 데이터베이스, 웹페이지 등 웹상의 대부분의 정보가 수집 대상이다.
- 파일의 경우 수집기가 파일명, 파일 내용, 파일 경로 등의 정보를 수집하고 저장하면 검색엔진이 저장된 정보를 검색하고, 사용자 질의에 답한다.
## 스토리지
- 데이터베이스에서 데이터를 저장하는 물리적인 저장소
- 검색엔진은 색인한 데이터를 스토리지에 보관한다.
## 색인기
- 검색엔진이 수집한 정보에서 사용자 질의와 일치하는 정보를 찾으려면 수집된 데이터를 검색 가능한 구조로 가공하고 저장해야하는데, 그 역할을 하는 것이 색인기이다.
- 색인기는 다양한 형태소 분석기를 조합해 정보에서 의미가 있는 용어를 추출하고 검색에 유리한 역색인 구조로 데이터를 저장한다.
## 검색기
- 사용자 질의를 입력받아 색인기에서 저장한 역색인 구조에서 일치하는 문서를 찾아 결과로 반환한다.
- 질의와 문서가 일치하는지는 유사도 기반의 검색 순위 알고리즘으로 판단한다.
- 형태소 분석기를 이용해 사용자 질의에서 유의미한 용어를 추출해 검색하며, 사용하는 형태소 분석기에 따라 검색 품질이 달라진다.

# 관계형 데이터베이스와의 차이점
## 데이터베이스
- 모든 데이터는 중복을 제거하고 정형 데이터로 구조화해 행과 열로 구성된 테이블에 저장된다.
- SQL 문을 이용해 원하는 정보의 검색이 가능한데 텍스트 매칭을 통한 단순한 검색만 가능하다.
- 텍스트를 여러 단어로 변형하거나 여러 개의 동의어나 유의어를 활용한 검색은 불가능하다.
## 검색엔진
- 데이터베이스에서는 불가능한 비정형 데이터를 색인하고 검색할 수 있다.
- 형태소 분석을 통해 사람이 구사하는 자연어의 처리가 가능해지고 역색인 구조를 바탕으로 빠른 검색 속도를 보장한다.
## 엘라스틱서치와 관계형 데이터베이스 비교
| 엘라스티서치 | 관계형 데이터베이스
|---|---|---
| 인덱스(Index) | 데이터베이스(Daabase)
| 샤드(Shard) | 파티션(Partition)
| 타입(Type) | 테이블(Table)
| 문서(Document) | 행(row)
| 필드(Field) | 열(Column)
| 매핑(Mapping) | 스키마(Schema)
| Query DSL | SQL
- 6.0 이하 버전에서는 하나의 인덱스 내부에 기능에 따라 데이터를 분류하고 여러 개의 타입을 만들어 사용했지만 현재는 하나의 인덱스에 하나의 타입만을 구성하도록 변경됨
## 추가, 검색, 삭제, 수정 기능 비교
| 엘라스틱서치에서 사용하는 HTTP 메서드 | 기능 | 데이터베이스 질의 문법
|---|---|---
| GET | 데이터 조회 | SELECT
| PUT | 데이터 생성 | INSERT
| POST | 인덱스 업데이트, 데이터 조회| UPDATE, SELECT
| DELETE | 데이터 삭제 | DELETE
| HAED | 인덱스의 정보 확인 | -
## 데이터베이스에서 '가마돈'이라는 사용자 데이터 조회
```SQL
SELECT * FROM USER WHERE Name like '%가마돈%'
```
## 엘라스틱서치에서 검색
```bash
GET http://localhost:9200/user/_search?q=Name:가마돈
```
